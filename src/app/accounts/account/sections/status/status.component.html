@if (!hasConnection) {
  <div class="empty-state">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
      <polyline points="22 4 12 14.01 9 11.01" />
    </svg>
    <p>No service connection to test. Link this account to a service to enable connection testing.</p>
  </div>
} @else {
  <div class="row g-4">
    <!-- Connection Info -->
    <div class="col-12">
      <div class="connection-info">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h6 class="section-title">Connection Details</h6>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Service</span>
                <span class="info-value">
                  @if (account?.connectionColor) {
                    <span class="service-dot" [style.background-color]="account?.connectionColor"></span>
                  }
                  {{ account?.connectionName }}
                </span>
              </div>
              <div class="info-item">
                <span class="info-label">Base URL</span>
                <code class="info-value url-value">{{ account?.baseUrl || 'Not configured' }}</code>
              </div>
              <div class="info-item">
                <span class="info-label">Credentials</span>
                <span class="info-value">
                  @if (account?.credentials?.hasCredentials) {
                    <span class="status-badge status-badge-success">Configured</span>
                  } @else {
                    <span class="status-badge status-badge-warning">Not configured</span>
                  }
                </span>
              </div>
            </div>
          </div>

          <button class="btn btn-primary" (click)="testConnection()" [disabled]="testing || !hasBaseUrl">
            @if (testing) {
              <span class="spinner-border spinner-border-sm me-1" role="status"></span>
              Testing...
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                <path d="M22 2L11 13" />
                <path d="M22 2l-7 20-4-9-9-4 20-7z" />
              </svg>
              Test Connection
            }
          </button>
        </div>

        @if (!hasBaseUrl) {
          <div class="form-text text-warning mt-2">
            No base URL configured. Set the base URL in the API tab before testing.
          </div>
        }
      </div>
    </div>

    <!-- Test Results -->
    @if (testResult) {
      <div class="col-12">
        <div class="test-result" [class.test-success]="testResult.success" [class.test-failure]="!testResult.success">
          <div class="result-header">
            @if (testResult.success) {
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
              </svg>
              <h6>Connection Successful</h6>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
              </svg>
              <h6>Connection Failed</h6>
            }
          </div>

          <div class="result-details">
            <div class="result-item">
              <span class="result-label">Status Code</span>
              <span class="result-value">{{ testResult.statusCode || 'N/A' }}</span>
            </div>
            <div class="result-item">
              <span class="result-label">Response Time</span>
              <span class="result-value">{{ testResult.responseTimeMs }}ms</span>
            </div>
            <div class="result-item">
              <span class="result-label">Message</span>
              <span class="result-value">{{ testResult.message }}</span>
            </div>
            <div class="result-item">
              <span class="result-label">Tested At</span>
              <span class="result-value">{{ testResult.testedAt | date:'medium' }}</span>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Test Error -->
    @if (testError) {
      <div class="col-12">
        <div class="test-result test-failure">
          <div class="result-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="8" x2="12" y2="12" />
              <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <h6>{{ testError }}</h6>
          </div>
        </div>
      </div>
    }
  </div>
}