<div class="auth-page">
  <div class="auth-card">
    <div class="auth-header">
      <div class="auth-logo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="418 370 300 260" width="36" height="36"
             role="img" aria-label="Egibi logo">
          <g fill="currentColor" fill-rule="evenodd">
            <path d="M481 459L493 459L494 460L503 460L504 459L507 459L508 458L509 458L510 457L511 457L512 456L513 456L514 455L515 455L516 454L517 454L519 452L520 452L523 449L524 449L525 448L524 447L521 447L520 446L516 446L515 445L512 445L511 444L508 444L507 443L504 443L503 442L495 442L492 445L492 446L490 448L490 449L481 458Z"/>
            <path d="M679 406L522 384L474 437L418 475L442 524L478 526L463 540L448 537L454 559L499 560L522 616L545 608L541 552L562 602L604 581L555 505L517 491L510 522L447 512L437 490L451 474L441 471L477 447L497 422L596 410L587 433L557 447L573 466L559 498L620 568L665 535L599 472L673 514L695 481L623 439L688 461ZM598 471L599 470L600 471L599 472ZM596 470L597 469L598 469L599 470L598 471L597 471Z"/>
          </g>
        </svg>
      </div>
      <h1>Set new password</h1>
      <p>Choose a strong password for your account</p>
    </div>

    @if (success()) {
      <div class="auth-alert auth-alert-success">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <span>Your password has been reset successfully.</span>
      </div>
      <a routerLink="/auth/login" class="auth-btn-primary" style="text-decoration: none; text-align: center;">
        Sign in with new password
      </a>
    } @else {
      @if (error()) {
        <div class="auth-alert auth-alert-error">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" x2="12" y1="8" y2="12"/>
            <line x1="12" x2="12.01" y1="16" y2="16"/>
          </svg>
          <span>{{ error() }}</span>
        </div>
      }

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="auth-field">
          <label for="newPassword">New password</label>
          <div class="input-with-toggle">
            <input
              id="newPassword"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="newPassword"
              placeholder="••••••••"
              autocomplete="new-password"
            />
            <button type="button" class="toggle-password" (click)="togglePassword()" tabindex="-1">
              @if (showPassword()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
                  <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
                  <line x1="1" x2="23" y1="1" y2="23"/>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              }
            </button>
          </div>

          @if (form.get('newPassword')?.dirty) {
            <div class="password-requirements">
              <div class="req-title">Password must contain:</div>
              <div class="req-item" [class.met]="hasMinLength()">
                @if (hasMinLength()) { ✓ } @else { ○ } At least 8 characters
              </div>
              <div class="req-item" [class.met]="hasUpper()">
                @if (hasUpper()) { ✓ } @else { ○ } One uppercase letter
              </div>
              <div class="req-item" [class.met]="hasLower()">
                @if (hasLower()) { ✓ } @else { ○ } One lowercase letter
              </div>
              <div class="req-item" [class.met]="hasNumber()">
                @if (hasNumber()) { ✓ } @else { ○ } One number
              </div>
              <div class="req-item" [class.met]="hasSpecial()">
                @if (hasSpecial()) { ✓ } @else { ○ } One special character
              </div>
            </div>
          }
        </div>

        <div class="auth-field">
          <label for="confirmPassword">Confirm password</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            placeholder="••••••••"
            autocomplete="new-password"
          />
        </div>

        <button
          type="submit"
          class="auth-btn-primary"
          [disabled]="loading()"
        >
          @if (loading()) {
            <span class="spinner"></span>
            Resetting...
          } @else {
            Reset password
          }
        </button>
      </form>
    }
  </div>
</div>
